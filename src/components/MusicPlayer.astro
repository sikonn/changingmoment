---
---

<div id="musicToggle">
  <img
    src="https://res.stelpolva.moe/stpv/615a661f-3b7c-4ba9-b29a-f1b8eee13979.apng"
    alt="Toggle Music"
    width="73"
    height="85"
  />
</div>

<audio id="audioPlayer" preload="auto"></audio>

<script>
  const audioPlayer = document.getElementById('audioPlayer');
  const musicToggle = document.getElementById('musicToggle');
  const totalTracks = 50;

  // 随机选一首
  let currentTrack = Math.floor(Math.random() * totalTracks) + 1;
  audioPlayer.src = `/music/music${currentTrack}.m4a`;

  let clickCount = 0;
  let clickTimer;

  function playRandomTrack() {
    currentTrack = Math.floor(Math.random() * totalTracks) + 1;
    audioPlayer.src = `/music/music${currentTrack}.m4a`;
    audioPlayer.play();
  }

  musicToggle.addEventListener('click', () => {
    clickCount++;
    clearTimeout(clickTimer);

    clickTimer = setTimeout(() => {
      if (clickCount === 1) {
        audioPlayer.play();
      } else if (clickCount === 2) {
        audioPlayer.pause();
      } else if (clickCount === 3) {
        playRandomTrack();
      }
      clickCount = 0;
    }, 300);
  });

  audioPlayer.addEventListener('ended', () => {
    playRandomTrack();
  });

  // 自动播放 - 页面加载后立即尝试播放
  window.addEventListener('load', () => {
    audioPlayer.play().catch(e => {
      console.log('自动播放失败，可能被浏览器阻止:', e);
    });
  });
</script>